{"version":3,"file":"web.js","sourceRoot":"","sources":["../../src/web.ts"],"names":[],"mappings":"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","sourcesContent":["import { WebPlugin } from '@capacitor/core';\n\nimport type { Auth0CapacitorPlugin } from './definitions';\nimport { createAuth0Client, Auth0Client, GetTokenSilentlyVerboseResponse } from '@auth0/auth0-spa-js';\n\nexport class Auth0CapacitorWeb\n  extends WebPlugin\n  implements Auth0CapacitorPlugin {\n\n  _auth0?: Promise<Auth0Client>;\n  domain?: string;\n  client_id?: string;\n\n  get auth0() {\n    return this._auth0;\n  }\n\n  set auth0(client) {\n    this._auth0 = client;\n  }\n\n  async createAuth0Client(options: {\n    domain: string;\n    clientId: string;\n    authorizationParams: {\n      redirect_uri: string;\n    };\n  }): Promise<void> {\n    this.auth0 = createAuth0Client({\n      domain: options.domain,\n      clientId: options.clientId,\n      authorizationParams: options.authorizationParams\n    });\n\n    this.domain = options.domain;\n    this.client_id = options.clientId\n  }\n  \n  async login(options: {\n    scope: string;\n    appState?: string;\n    audience: string;\n    redirect_uri?: string\n  }): Promise<any> {\n    console.log(\"Logging in! 1\");\n\n    (await this.auth0)?.loginWithRedirect({\n      ...options\n    });\n  }\n\n  async handleRedirect(): Promise<any> {\n    const query = window.location.search;\n\n    if (!query.length) return;\n    \n    if (query.includes(\"code=\") && query.includes(\"state=\")) {\n      // Process the login state\n      const resultP = (await this.auth0)?.handleRedirectCallback()\n        .then(async (result) => {\n          console.log(result);\n          return (await this.auth0)?.getTokenSilently();\n        });\n\n      return await resultP;\n\n    }\n  }\n\n  async renew(): Promise<GetTokenSilentlyVerboseResponse | undefined> {\n    const client = await this.auth0;\n    const isAuth = client?.isAuthenticated();\n\n    if (isAuth) {\n      return client?.getTokenSilently({ detailedResponse: true })\n    } else {\n      const query = window.location.search;\n      if (query.includes(\"code=\") && query.includes(\"state=\")) {\n        // Process the login state\n        return client?.handleRedirectCallback(location.href)\n\n        .then((result) => {\n          console.log(result);\n\n          return client?.getTokenSilently({ detailedResponse: true });\n        });\n    } else {\n        throw 'not authenticated';\n      }\n    }\n  }\n  \n  async logout() {\n    (await this.auth0)?.logout({\n      logoutParams: {\n        returnTo: window.location.origin\n      }\n    });\n  }\n\n  async getUser(): Promise<any>{ \n    return (await this.auth0)?.getUser();\n  }\n\n  async getTokenSilently(): Promise<GetTokenSilentlyVerboseResponse | undefined> {\n    return this.renew();\n  }\n}\n\n\n"]}